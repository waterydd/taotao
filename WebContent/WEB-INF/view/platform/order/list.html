
<div class="row">
	<div class="col-md-12">
		<ol class="breadcrumb">
			<li><a href="#" onclick="common_ajax.ajaxMainPanel('/jf/platform/index/content');">${i18nMap["admin.common.mainPage"]}</a></li>
			<li class="active">商品订单列表</li>
		</ol>
	</div>
</div>
						
<form id="splitPage" action="${cxt!}/jf/platform/order" method="POST" role="form" class="form-horizontal">
	
	<div class="row">
		<div class="col-md-12">
			<!-- start: BORDERED TABLE PANEL -->
			<div class="panel panel-white">
				
				<div class="panel-heading">
					<h4 class="panel-title"><span class="text-bold">${i18nMap["admin.partner.list.select"]}</span></h4>
					<div class="panel-tools">										
						<% include("/common/panel-tools.html"){} %>
					</div>
				</div>
				
				  	
					<div class="form-group">
						<label class="col-sm-2 control-label" for="focusedInput">交易流水号</label>
						<div class="col-sm-4">
					  		<input class="form-control focused" type="text" name="_query.trade_flowno" value='${escapeXml(paramMap["_query.trade_flowno"])}' maxlength="30" >
						</div>
				  	</div>
				  							
					<div class="form-group">
						<label class="col-sm-2 control-label" for="focusedInput">订单号</label>
						<div class="col-sm-4">
					  		<input class="form-control focused" type="text" name="_query.order_no" value='${escapeXml(paramMap["_query.order_no"])}' maxlength="35" >
						</div>
				  	</div>
				  	
				  	<div class="form-group">
						<label class="col-sm-2 control-label" for="focusedInput">商品名字</label>
						<div class="col-sm-4">
					  		<input class="form-control focused" type="text" name="_query.goods_name" value='${escapeXml(paramMap["_query.goods_name"])}' maxlength="100" >
						</div>
				  	</div>
				  					  	
					<div class="form-group">
						<label class="col-sm-2 control-label">创建时间</label>
						<div class="col-sm-2">
							<input type="text" name="_query.create_datetime" 
								value='${escapeXml(paramMap["_query.create_datetime"])}' 
					  			data-date-format="yyyy-mm-dd" data-date-viewmode="years" class="form-control date-picker">
						</div>
						
						<div class="col-sm-2">
							<input type="text" name="_query.create_datetime2"
								value='${escapeXml(paramMap["_query.create_datetime2"])}' 
					  			data-date-format="yyyy-mm-dd" data-date-viewmode="years" class="form-control date-picker">
						</div>
						<span class="help-inline col-sm-2"> <i class="fa fa-info-circle"></i>* 不包含最后一天</span>
					</div>
				  	
				  	<!-- <div class="form-group">
						<label class="col-sm-2 control-label" for="focusedInput">卖家ID</label>
						<div class="col-sm-4">
					  		<input class="form-control focused" type="text" name="_query.uid" value='${escapeXml(paramMap["_query.uid"])}' maxlength="8" >
						</div>
				  	</div> -->
				  	
				  	<div class="form-group">
						<label class="col-sm-2 control-label" for="focusedInput">状态</label>
						<div class="col-sm-4">
					  		<select name="_query.status" class="combox">
								<option value="">全部</option>
								<option value="WAIT" ${paramMap["_query.status"]! == "WAIT" ? "selected='selected'":"" }>初始状态</option>
								<option value="PENDING_SEND" ${paramMap["_query.status"]! == "PENDING_SEND" ? "selected='selected'":"" }>待发货</option>
								<option value="SELLER_SENT" ${paramMap["_query.status"]! == "SELLER_SENT" ? "selected='selected'":"" }>卖家已发货</option>
								<option value="TRADE_SUCCESS" ${paramMap["_query.status"]! == "TRADE_SUCCESS" ? "selected='selected'":"" }>交易成功</option>
								<option value="PAY_FAILURE" ${paramMap["_query.status"]! == "PAY_FAILURE" ? "selected='selected'":"" }>支付失败</option>
								<option value="PAY_TIME_OUT" ${paramMap["_query.status"]! == "PAY_TIME_OUT" ? "selected='selected'":"" }>支付超时</option>
								<option value="CLOSED" ${paramMap["_query.status"]! == "CLOSED" ? "selected='selected'":"" }>交易关闭</option>
								<option value="REFUND" ${paramMap["_query.status"]! == "REFUND" ? "selected='selected'":"" }>退款中</option>
								<option value="SUCCESS" ${paramMap["_query.status"]! == "SUCCESS" ? "selected='selected'":"" }>支付成功</option>
							</select>
						</div>

				  	</div>
				  	
					<div class="form-group">
						<div class="col-sm-5 col-sm-offset-5">
							<button type="button" class="btn btn-primary" onclick='common_ajax.ajaxFormMainPanel("splitPage");'>查询</button>
							<button type="reset" class="btn">重置</button>
						</div>
				  	</div>
				</div>
			
			</div>
		</div>
	</div>
	
	<div class="row">
		<div class="col-md-12">
			<!-- start: BORDERED TABLE PANEL -->
			<div class="panel panel-white">
				
				<div class="panel-heading">
					<h4 class="panel-title">
						<span class="text-bold">商品订单列表</span>
					</h4>
					<div class="panel-tools">										
						<% include("/common/panel-tools.html"){} %>
					</div>
				</div>
				
				<!-- 查看信息 编辑信息 删除信息 -->
				<%
					var view = authUrl("/jf/platform/order/view");
					var edit = authUrl("/jf/platform/order/edit");
					
				%>
			
				<div class="panel-body" style="height:400px;overflow:auto;">
				
					<table class="table table-bordered table-hover" id="dataTable" >
						<thead>
							<tr align="center">
								<th class="hidden-xs" onclick="common_splitPage.orderbyFun('mainPanel', 'splitPage', '')">
									订单号
								</th>
								<th class="hidden-xs" onclick="common_splitPage.orderbyFun('mainPanel', 'splitPage', '')">
									交易流水号
								</th>
								<!-- <th class="hidden-xs" onclick="common_splitPage.orderbyFun('mainPanel', 'splitPage', '')">
									支付成功流水号
								</th> -->
								<th style="text-align:center;" class="hidden-xs" onclick="common_splitPage.orderbyFun('mainPanel', 'splitPage', '')">
									创建时间
								</th>
								<th class="hidden-xs" onclick="common_splitPage.orderbyFun('mainPanel', 'splitPage', '')">
									商品信息
								</th>
								<th class="hidden-xs" onclick="common_splitPage.orderbyFun('mainPanel', 'splitPage', '')">
									商品名字
								</th>
								<th class="hidden-xs" onclick="common_splitPage.orderbyFun('mainPanel', 'splitPage', '')">
									数量
								</th>
								<th class="hidden-xs" onclick="common_splitPage.orderbyFun('mainPanel', 'splitPage', '')">
									总价
								</th>
								<!-- <th class="hidden-xs" onclick="common_splitPage.orderbyFun('mainPanel', 'splitPage', '')">
									付费通道
								</th> -->
								<th style="text-align:center;" class="hidden-xs" onclick="common_splitPage.orderbyFun('mainPanel', 'splitPage', '')">
									状态
								</th>
								<th class="hidden-xs" onclick="common_splitPage.orderbyFun('mainPanel', 'splitPage', '')">
									成功时间
								</th>
							
								<th align="center" class="hidden-xs">${i18nMap["admin.common.operation"]}</th>
							</tr>
						</thead>
						
						<!-- 循环显示数据的地方 -->
						<tbody>
							<% for(order in splitPage.list){ %>
								<tr>
									<td align="left">${escapeXml(order["order_no"]!)}</td> <!-- 订单号 -->
									<td align="left">${escapeXml(order["trade_flowno"]!)}</td> <!-- 状态 -->
									<!-- <td align="left">${escapeXml(order["success_pay_flowno"]!)}</td> 支付成功流水号 -->
									<td align="center">${escapeXml(order["create_datetime"]!)}</td> <!-- 商品 msg -->
									<td align="center">${escapeXml(order["goods_msg"]!)}</td> <!--  -->
									<td align="center">${escapeXml(order["goods_name"]!)}</td> <!-- 商品名字 -->
									<td align="center">${escapeXml(order["num"]!)}</td> <!-- 状态 -->
									
									<td align="center">${escapeXml(order["total_amount"]!)}</td> <!-- 状态 -->
									<!-- <td align="center">${escapeXml(order["pay_channel"]!)}</td> 付费通道 -->
									<td align="center">
										<% if(order["status"] == "WAIT"){%>
											<span class="label label-success">初始状态</span>
										<% } else if(order["status"] == "PENDING_SEND"){%>
											<span class="label label-warning">待发货(支付完成)</span>
										<% } else if(order["status"] == "SELLER_SENT"){%>
											<span class="label label-warning">卖家已发货</span>
										<% } else if(order["status"] == "TRADE_SUCCESS"){%>
											<span class="label label-warning">交易成功</span>
										<% } else if(order["status"] == "PAY_FAILURE"){%>
											<span class="label label-warning">支付失败</span>
										<% } else if(order["status"] == "PAY_TIME_OUT"){%>
											<span class="label label-warning">支付超时</span>
										<% } else if(order["status"] == "CLOSED"){%>
											<span class="label label-warning">交易关闭</span>
										<% } else if(order["status"] == "REFUND"){%>
											<span class="label label-warning">退款中</span>
										<% } else if(order["status"] == "SUCCESS"){%>
											<span class="label label-warning">支付成功</span>
										<% } %>
									</td>
									<td align="center">${escapeXml(order["success_datetime"]!)}</td> <!-- 状态 -->
									
									<td class="hidden-xs"><!--  操作 -->
										
										<% if(view == true){ %>
											<button type="button" class="btn btn-dark-yellow add-row" onclick="common_ajax.ajaxMainPanel('/jf/platform/order/view/${escapeXml(order['order_no']!)}');">
												${i18nMap["admin.common.see"]} <i class="fa fa-eye"></i>
											</button>
										<% } %>
										
										<% if(order["status"] == "PENDING_SEND") {%>
											<% if(edit == true){ %>
												<button type="button" class="btn btn-green edit-row" onclick="common_ajax.ajaxMainPanel('/jf/platform/order/edit/${escapeXml(order['order_no']!)}');"> 
													发货 <i class="fa fa-edit"></i>
												</button>
											<% } %>
										<% } %>
										
									</td>
								</tr>
							<% } %>
						</tbody>
					</table>
					
					<div class="row" id="splitPageDiv">
						<% include("/common/splitPage.html", {"divId" : "mainPanel", "formId" : "splitPage", "splitPageDiv" : "splitPageDiv"}){} %>
					</div>
					
				</div>
			
			</div>
			<!-- end: BORDERED TABLE PANEL -->
		</div>
	</div>
	
</form>			
<script type="text/javascript">
	jQuery(document).ready(function() {
		common_form.init();
	});
	function cls(){
		var pay_flowno =document.getElementById('pay_flowno').value;
		
		if(pay_flowno != ''){
			$.ajax({
				type:"post",
				url: "/jf/platform/payFlow/getTradeFlowno",
				
				data:{
						"payFlow.pay_flowno":$('#pay_flowno').val()
						
					},
				async:true,
				success:function(data){
					var str = '';
					str = data.trade
					if(str == '1') {
						str = '';
						alert('这个是为空的时候：'+str);
					}
					$('#pay_flowno2').val(str);
					console.log(data);
					
				}
			}); 
			
		}else{
			/* alert('这里走了为空： '+pay_flowno); */
		}
	    
	}
	
	
</script>
